<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>SMACK PTA AGM Countdown</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <style>
    body {
      font-family: sans-serif;
      background: #0f172a;
      color: white;
      text-align: center;
      padding: 20px;
    }

    .event-image {
      max-width: 500px;
      margin: 0 auto 30px;
      border-radius: 10px;
      box-shadow: 0 0 20px rgba(0,0,0,0.5);
      background: #1e293b;
      padding: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      font-weight: bold;
    }

    .countdown {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 20px;
      flex-wrap: wrap;
    }

    .unit {
      background: #1e293b;
      border-radius: 50%;
      width: 100px;
      height: 100px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      font-size: 18px;
      font-weight: bold;
      border: 2px solid #38bdf8;
    }

    .unit span {
      font-size: 30px;
      margin-bottom: 5px;
      color: #38bdf8;
    }

    #start-btn {
      margin-top: 30px;
      padding: 12px 24px;
      font-size: 16px;
      font-weight: bold;
      background: #38bdf8;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: background 0.3s;
    }

    #start-btn:hover {
      background: #0ea5e9;
    }

    #start-btn:disabled {
      background: gray;
      cursor: not-allowed;
    }

    .event-started {
      font-size: 32px;
      color: #22c55e;
      font-weight: bold;
      margin-top: 20px;
    }

    .status-message {
      margin-top: 20px;
      padding: 10px;
      background: #1e293b;
      border-radius: 5px;
      font-size: 14px;
    }

    .online-indicator {
      display: inline-block;
      width: 10px;
      height: 10px;
      background: #22c55e;
      border-radius: 50%;
      margin-right: 5px;
    }

    .offline-indicator {
      display: inline-block;
      width: 10px;
      height: 10px;
      background: #ef4444;
      border-radius: 50%;
      margin-right: 5px;
    }
  </style>
</head>
<body>

  <h1>SMACK PTA AGM Countdown</h1>
  <p>Join us on <strong>July 20, 2025 @ 9:00 AM</strong> at SMACK Campus, Kisubi</p>

  <!-- Placeholder for event image -->
  <div class="event-image">
    SMACK PTA AGM Event Poster
  </div>

  <div id="countdown" class="countdown">
    <div class="unit"><span id="days">00</span>Days</div>
    <div class="unit"><span id="hours">00</span>Hours</div>
    <div class="unit"><span id="minutes">00</span>Minutes</div>
    <div class="unit"><span id="seconds">00</span>Seconds</div>
  </div>

  <button id="start-btn">Start Countdown</button>
  
  <div id="status" class="status-message">
    <span id="connection-status">Connecting...</span>
  </div>

  <script>
    // Firebase configuration - You'll need to replace this with your own
    const firebaseConfig = {
      apiKey: "demo-key",
      authDomain: "smack-countdown-demo.firebaseapp.com",
      databaseURL: "https://smack-countdown-demo-default-rtdb.firebaseio.com/",
      projectId: "smack-countdown-demo",
      storageBucket: "smack-countdown-demo.appspot.com",
      messagingSenderId: "123456789",
      appId: "1:123456789:web:demo"
    };

    // For demo purposes, we'll use a simulated Firebase-like behavior
    // In production, you'd use the real Firebase config above
    
    const TARGET_DATE = new Date("2025-07-20T09:00:00").getTime();
    const startBtn = document.getElementById("start-btn");
    const statusEl = document.getElementById("status");
    const connectionStatusEl = document.getElementById("connection-status");
    
    let countdownInterval = null;
    let syncInterval = null;
    let isConnected = false;
    let startTime = null;

    // Simulated Firebase-like database
    class SyncedCountdown {
      constructor() {
        this.listeners = [];
        this.data = { started: false, startTime: null };
        this.connect();
      }

      connect() {
        // Simulate connection
        setTimeout(() => {
          this.isConnected = true;
          this.updateConnectionStatus(true);
          this.loadFromStorage();
          this.startSync();
        }, 1000);
      }

      updateConnectionStatus(connected) {
        isConnected = connected;
        if (connected) {
          connectionStatusEl.innerHTML = '<span class="online-indicator"></span>Connected - Countdown synchronized';
        } else {
          connectionStatusEl.innerHTML = '<span class="offline-indicator"></span>Offline - Using local time';
        }
      }

      loadFromStorage() {
        const saved = localStorage.getItem('smack_countdown_sync');
        if (saved) {
          this.data = JSON.parse(saved);
          this.notifyListeners();
        }
      }

      saveToStorage() {
        localStorage.setItem('smack_countdown_sync', JSON.stringify(this.data));
      }

      startSync() {
        // Simulate real-time sync every 5 seconds
        syncInterval = setInterval(() => {
          if (this.data.started && this.data.startTime) {
            // In a real Firebase setup, this would sync with the server
            this.notifyListeners();
          }
        }, 5000);
      }

      on(callback) {
        this.listeners.push(callback);
      }

      set(path, value) {
        if (path === 'started') {
          this.data.started = value;
          if (value) {
            this.data.startTime = Date.now();
          }
        }
        this.saveToStorage();
        this.notifyListeners();
        return Promise.resolve();
      }

      notifyListeners() {
        this.listeners.forEach(callback => callback(this.data));
      }
    }

    const db = new SyncedCountdown();

    // Listen for countdown state changes
    db.on((data) => {
      if (data.started && data.startTime) {
        startTime = data.startTime;
        startBtn.disabled = true;
        startBtn.textContent = "Countdown Running...";
        startCountdown();
      }
    });

    function handleStart() {
      if (!isConnected) {
        alert("Please wait for connection to establish before starting the countdown.");
        return;
      }

      startBtn.disabled = true;
      startBtn.textContent = "Starting...";
      
      db.set('started', true).then(() => {
        console.log("Countdown started and synchronized!");
      }).catch((error) => {
        console.error("Error starting countdown:", error);
        startBtn.disabled = false;
        startBtn.textContent = "Start Countdown";
      });
    }

    function startCountdown() {
      // Clear any existing interval
      if (countdownInterval) {
        clearInterval(countdownInterval);
      }

      countdownInterval = setInterval(() => {
        const now = Date.now();
        const distance = TARGET_DATE - now;

        if (distance <= 0) {
          clearInterval(countdownInterval);
          document.getElementById("countdown").innerHTML = '<div class="event-started">ðŸŽ‰ The Event Has Started! ðŸŽ‰</div>';
          return;
        }

        const days = Math.floor(distance / (1000 * 60 * 60 * 24));
        const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((distance % (1000 * 60)) / 1000);

        document.getElementById("days").textContent = String(days).padStart(2, "0");
        document.getElementById("hours").textContent = String(hours).padStart(2, "0");
        document.getElementById("minutes").textContent = String(minutes).padStart(2, "0");
        document.getElementById("seconds").textContent = String(seconds).padStart(2, "0");
      }, 1000);
    }

    // Initialize on page load
    window.addEventListener('load', () => {
      startBtn.addEventListener("click", handleStart);
    });

    // Clean up on page unload
    window.addEventListener('beforeunload', () => {
      if (countdownInterval) clearInterval(countdownInterval);
      if (syncInterval) clearInterval(syncInterval);
    });
  </script>

  <div style="margin-top: 40px; font-size: 12px; color: #64748b;">
    <p><strong>Setup Instructions:</strong></p>
    <p>1. Create a Firebase project at <a href="https://console.firebase.google.com" target="_blank" style="color: #38bdf8;">Firebase Console</a></p>
    <p>2. Enable Realtime Database</p>
    <p>3. Replace the demo firebaseConfig with your actual Firebase config</p>
    <p>4. Set database rules to allow read/write access</p>
  </div>

</body>
</html>